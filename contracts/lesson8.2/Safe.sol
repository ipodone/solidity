// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

// ！！！！智能合约：一旦部署，无法修改

// 理解存储="写出高质量合约"
// 理解数组特性 = 避免致命错误
// 掌握组合模式 = 掌握数据设计精髓
// 掌握函数=掌握智能合约核心
// 在区块链上，每一行代码都关系到真金白银。安全永远是第一位的。
// 事件是连接智能合约与外部世界的桥梁
// 防御重点: 权限控制 + 输入验证 + 状态管理

contract Safe {
    // 5大安全漏洞：1、重入攻击 (Reentrancy)、2、整数溢出 (Integer Overflow)、3、权限控制 (Permission Control)、4、拒绝服务 (DoS Attack)、5、前端运行攻击 (Front-Running)
    // 1、重入锁，即互斥锁：不建议大家自己实现重入锁，会有细节问题 - 所以推荐OpenZeppelin的ReentrancyGuard：继承它，并在需要保护的函数上加上nonReentrant修饰符
    // 2、uint256（无符号整数最大255）整数溢出，加法上溢：本应为255+1=256，但最大为255，实际上溢回到0；减法下溢：本应为0-1=-1，但最小值是0，实际下溢出回到255 - unchecked禁止溢出检查（不推荐，除非你有充分的理由，如for循环100次绝对不会超过256，能节省50%的gas）
    // 默认检查整数溢出，在确保安全的情况下用unchecked并添加注释。不同大小类型转换前，先检查范围再转换，最后测试边界情况
    // 3、权限控制之OpenZepplin：
    // Ownable合约 - 适用于只有一个管理员的场景
    // AccessControl角色管理（minterrole - 铸造代币角色、burner_role - 销毁代币角色、admin_role - 管理角色）- 多角色复杂管理，适用于复杂型业务需求
    // 多重签名方案（需要多个管理员共同管理签名，才能执行一些关键的操作，大大降低了一个单点的风险，即使一个私钥被盗了，自己也是安全的） - 适用于高价值合约
    // 另：在权限转移方面，不要直接使用transferOwnership，应该使用两步一个转移：即先pengding一个新的owner，新的owner必须主动accept才能完成转移。这避免了将owner设置为错误地址或不可用地址
    // 4、所有DoS攻击都会导致交易无法执行或消耗过多Gas，增加交易成本
    // 拉取模式防御优势；接收方控制Gas使用、可分批处理交易、提高交易成功率
    // 5、什么是前端运行攻击（抢跑）：前端运行攻击（Front-Running）是指攻击者观察到某笔交易在区块链网络中，抢先提交自己的交易，以影响原交易的执行结果或获取不当利益。
    // 攻击原理： 攻击者抢先提交更高Gas价格的交易，获取交易差价。
    // MEV是什么：MEV (Maximal Extractable Value) 表示通过交易排序和替换所能获取的最大价值总和，是区块链经济中的重要概念。
    // Commit-Reveal防御方案：防止前端运行攻击的两阶段提交机制 - 第一阶段：Commit（提交）、第二阶段：Reveal（揭示）
    // 前端运行其他防御方法：防止前端运行攻击的多种技术方案 - Flashbots私有交易池、价格滑点限制、批量拍卖机制、最小延迟策略
    // 最佳实践: 结合多种防御方法，根据应用场景选择合适的技术方案，平衡用户体验和安全性。
    // 6、安全检查清单：智能合约开发安全检查项 - 重入防护、权限控、输入验证、其他安全检查
    // 安全检查清单应作为开发流程的一部分，确保代码审查全面性
    // 7、安全开发流程：构建安全智能合约的全流程方法 - 设计阶段（威胁建模）、开发阶段（安全编码）、测试阶段（安全测试）、部署前（专业审计）、部署后（持续监控）
    // 安全开发循环: 安全不是一次性工作，而是贯穿整个开发周期的过程。定期培训团队，保持对新漏洞的关注，并不断完善安全流程。
}