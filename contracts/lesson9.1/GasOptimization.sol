// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

contract GasOptimization {
    // sload读取、sstore新值、sstore修改
    // sload：是 以太坊虚拟机（EVM）中的一个操作码（opcode），用于从存储（Storage）中读取数据。- 避免重复 sload，使用内存缓存
    // 在 EVM 中，合约的存储是一个持久的键值对存储（256 位 → 256 位）。sload 指令的作用是从存储槽（storage slot）中加载一个 256 位（32 字节）的值到堆栈上。
    // 永远不要在链上遍历大数组！链下遍历，链上只访问特定元素
    // 可见性修饰符成本排序：public昂贵（需要支持内部和外部调用，参数复制到memory）、external较贵（只支持外部调用，参数用calldata（更便宜））、internal（便宜）、private（最便宜） -  外部调用的函数 → 用 external（减少参数处理开销）、 内部辅助函数 → 用 internal 或 private
    // 短路求值：便宜的检查放前面
    // 事件替代存储：节省97%成本：使用Storage场景：链上需要读取的数据、影响合约逻辑的数据；使用Event场景：仅记录/查询的历史数据、前端显示的数据
    // 批量操作：减少交易次数 - 实际开发中比较常用
    // unchecked：跳过溢出检查

    // Gas优化核心要点
    // 一、六大优化技巧
    // 存储优化 → 打包变量，使用指针
    // 数据类型 → 选对类型，避免转换
    // 函数优化 → 用external，短路求值
    // 批量操作 → 减少交易，降低基础成本
    // unchecked → 安全场景跳过检查
    // 事件日志 → 替代不必要的存储
    // 二、四大优化原则：测量优先：用工具找瓶颈、安全第一：不牺牲安全性、20/80法则：优化热点函数、用户至上：降低用户成本
    // 三、智能合约安全最佳实践：重入攻击防护、整数溢出保护、访问控制机制


    // 一、空头代币：空投是指项目方向特定地址 免费分发代币 的行为，通常用于：奖励早期用户/持有者、项目宣传和获取用户、去中心化代币分配、社区建设
    // 二、如何参与空投：如何参与空投？
    // 1. 早期交互：在潜力项目中进行真实交易、提供流动性等
    // 2. 监控空投信息：关注项目官方公告、空投聚合网站
    // 3. 安全领取：只使用官方链接、小心钓鱼网站（不要泄露私钥）、确认合约经过审计

    // nonReentrant修饰符 与 CEI模式同时使用的简单说明：
    // 一、一句话核心观点：nonReentrant 修饰符是 CEI模式的一种实现和强化，二者共同构成“双重保险”，但它们在概念层级上有所不同。
    // 二、快速对比
    // 方面	    CEI 模式	            nonReentrant 修饰符 - 重入锁
    // 是什么	！代码编写模式	        ！具体的技术实现
    // 核心原则	！检查 → 生效 → 交互	    ！“锁定-执行-解锁”
    // 关注点	代码逻辑的顺序	            函数执行状态
    // 实现方式	开发者手动按顺序写代码	    使用布尔锁或 _status 变量
    // 防御范围	！逻辑层面的重入	            ！物理层面的重入（包括跨函数重入）
    // Gas成本	无额外成本	                有少量存储读写成本
    // 三、同时使用的说明；
    // 1. 它们解决的是同一个问题（重入攻击），但维度不同：CEI模式 是 逻辑规范、nonReentrant 是 物理锁
    // 2. 为什么需要同时使用：CEI模式是基础，但有局限性；nonReentrant 提供更坚固的保证
    // 3. 典型代码示例（同时使用二者）
    // ！！！4. 最佳实践：始终遵循CEI模式：这是编写安全合约的基本功；在涉及外部调用的函数上添加 nonReentrant - 特别是 withdraw()、mint()、execute() 等函数
    // 锁在函数执行前上锁，执行后解锁，完美包裹你的CEI逻辑
    // 同时使用时：你先按照安全规范操作（CEI），同时锁上门防止意外（nonReentrant），这样安全性最高。在现代Solidity开发中（尤其是2023年后），这被认为是涉及资金操作函数的标准配置。
}